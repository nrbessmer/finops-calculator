<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FinOps++</title>
  <!-- Bootstrap CSS for modern styling and collapse functionality -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Custom CSS with neon green text, dark theme, and ticker animation -->
  <style>
    body { 
      background: #121212; 
      font-family: Tahoma, sans-serif;
      color: #39FF14; /* Neon green */
      padding-bottom: 2rem;
    }
    a { color: #39FF14; }
    /* Header styling */
    .header {
      text-align: center;
      padding: 3rem 0;
      border-bottom: 3px solid #0d6efd;
      margin-bottom: 2rem;
    }
    .header h1 {
      font-size: 3rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }
    .header p {
      font-size: 1.2rem;
      color: #ccc;
    }
    /* Card styling with neon accents */
    .section-card { 
      margin-bottom: 1.5rem; 
      border: 1px solid #333;
      background: #1e1e1e;
      box-shadow: 0 4px 6px rgba(0,0,0,0.5);
    }
    .card-header { 
      background-color: #0d6efd; 
      color: #fff; 
      cursor: pointer;
      user-select: none;
      text-transform: uppercase;
      font-weight: bold;
      border-bottom: 1px solid #333;
      padding: 0.75rem 1.25rem;
    }
    .card-header:hover { background-color: #0b5ed7; }
    .card-body { 
      background: #1e1e1e; 
      color: #39FF14;
      padding: 1rem 1.25rem;
    }
    .instruction { 
      font-size: 0.9rem; 
      color: #39FF14; 
      margin-bottom: 1rem; 
    }
    .form-control {
      background: #2c2c2c;
      border: 1px solid #555;
      color: #39FF14;
    }
    .form-control:focus {
      background: #2c2c2c;
      border-color: #0d6efd;
      box-shadow: none;
      color: #39FF14;
    }
    .btn {
      border: none;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    footer { 
      text-align: center; 
      padding: 1rem 0; 
      margin-top: 2rem; 
      background: #1e1e1e; 
      color: #39FF14;
      border-top: 1px solid #333;
    }
    /* Ticker styling */
    .ticker-container {
      overflow: hidden;
      background: #000;
      border: 1px solid #39FF14;
      margin-bottom: 1rem;
    }
    .ticker {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: ticker 15s linear infinite;
      font-weight: bold;
      color: #39FF14;
    }
    @keyframes ticker {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }
  </style>
</head>
<body>
  <!-- Header (always visible) -->
  <div class="container">
    <div class="header">
      <h1>FinOps++</h1>
      <p>Cost Modeling • Live Cloud Pricing • Forecasting • Simulation • Exportable Reports</p>
    </div>
  </div>

  <div class="container">
    <!-- Extended Overview Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#overviewSection" aria-expanded="true" aria-controls="overviewSection">
        Overview
      </div>
      <div id="overviewSection" class="collapse show">
        <div class="card-body">
          <p>
            Cloud computing has transformed modern business by providing scalable, on-demand resources—but with this flexibility comes complex, dynamic pricing that can lead to unforeseen expenses. FinOps++ is designed to help you manage these challenges by integrating live pricing data (with fallback values to avoid timeouts) from major cloud providers. It empowers you to build detailed cost models, create accurate forecasts, and run sophisticated simulations to ensure that your cloud spending is both predictable and optimized.
          </p>
          <p>
            By breaking down overall cloud expenditure into granular components such as compute, storage, network, and licensing, FinOps++ allows you to see how usage patterns and tiered discounts impact your bottom line. The platform mirrors real-world pricing models, giving you a clear view of how exceeding thresholds can trigger discount rates or, conversely, drive costs upward.
          </p>
          <p>
            With robust forecasting capabilities, you can project costs over a 12‑month period based on anticipated growth. Monte Carlo simulations provide a statistical understanding of risk by running thousands of iterations, while sensitivity analysis helps pinpoint which variables most affect your finances.
          </p>
          <p>
            FinOps++ is not just a calculator—it’s a comprehensive tool that educates both IT and finance teams on the intricacies of cloud pricing. Detailed variable explanations and practical use cases ensure that you understand every aspect of your cost model, enabling data-driven decisions and effective negotiations with cloud providers.
          </p>
          <p>
            Whether you are a startup or a large enterprise, FinOps++ offers the insights needed to turn cloud cost management from a reactive process into a proactive strategic advantage, ultimately leading to improved budgeting, reduced financial risk, and enhanced operational efficiency.
          </p>
        </div>
      </div>
    </div>

    <!-- Practical Use Cases Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#useCaseSection" aria-expanded="true" aria-controls="useCaseSection">
        Practical Use Cases
      </div>
      <div id="useCaseSection" class="collapse show">
        <div class="card-body">
          <p>
            <strong>Hypothetical Business Scenario:</strong> Imagine you are the CFO of "CloudSavvy Retail," an e-commerce company relying on cloud services to power its website, manage customer data, and process orders. Following a highly successful marketing campaign, your website traffic surges by 300%, dramatically increasing your consumption of compute, storage, and network resources. This unexpected spike leads to significant cost overages that put your quarterly budget at risk.
          </p>
          <p>
            <strong>Step-by-Step Process Using FinOps++:</strong>
          </p>
          <ol>
            <li>
              <strong>Baseline Data Entry:</strong>
              <br>Input your fixed operational costs (e.g., management fees, licensing) along with revenue assumptions like average revenue per transaction and expected transaction volume. This establishes your financial baseline.
            </li>
            <li>
              <strong>Detailed Cost Modeling:</strong>
              <br>Break down your cloud spending into categories—compute, storage, network, and licensing—using tiered discount models that match your provider’s pricing. This reveals which cost centers are most sensitive to usage surges.
            </li>
            <li>
              <strong>Advanced Settings:</strong>
              <br>In the Advanced Settings section, configure parameters such as the Auto‑Scaling Factor (which lowers compute costs when resources scale efficiently) and the Dynamic Pricing Adjustment (which boosts revenue per unit under high-demand conditions). These settings let you simulate various strategies to control costs.
            </li>
            <li>
              <strong>Deterministic Calculation:</strong>
              <br>Run the deterministic calculation to get immediate key metrics—total revenue, total cost, profit, profit margin, and ROI. This helps you gauge the impact of the surge and assess if your current strategy is sustainable.
            </li>
            <li>
              <strong>Forecasting Future Costs:</strong>
              <br>Use the forecasting module to project cloud costs over the next 12 months based on your monthly growth rate. This forecast will show you potential future overages, allowing you to proactively plan for additional resources or budget adjustments.
            </li>
            <li>
              <strong>Monte Carlo Simulation:</strong>
              <br>Run a Monte Carlo simulation to model uncertainty by executing thousands of iterations. The resulting probability distribution enables you to quantify risk and set aside appropriate contingency funds.
            </li>
            <li>
              <strong>Sensitivity Analysis:</strong>
              <br>Perform sensitivity analysis on key variables such as discount rates and auto-scaling efficiency. This identifies the factors that most influence your costs, guiding you in negotiations and internal policy adjustments.
            </li>
          </ol>
          <p>
            <strong>Outcome:</strong> By following these steps with FinOps++, you gain a comprehensive understanding of your cloud spending drivers. In response, you negotiate better volume discounts, adjust auto-scaling policies, and refine your budgeting forecasts. This proactive approach transforms a potential crisis into an opportunity for strategic improvement.
          </p>
        </div>
      </div>
    </div>

    <!-- Variable Explanations Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#variableSection" aria-expanded="true" aria-controls="variableSection">
        Variable Explanations
      </div>
      <div id="variableSection" class="collapse show">
        <div class="card-body">
          <ul>
            <li><strong>Overall Fixed Cost ($):</strong> Baseline expenses that remain constant (e.g., management fees).</li>
            <li><strong>Base Revenue per Unit ($):</strong> Revenue earned per transaction or service unit at standard rates.</li>
            <li><strong>Revenue Units:</strong> The total number of transactions or service units consumed.</li>
            <li><strong>Elasticity Threshold (Revenue Units):</strong> The usage level at which revenue per unit begins to decline.</li>
            <li><strong>Elasticity Factor:</strong> The decrease in revenue per unit for each additional unit beyond the threshold.</li>
            <li><strong>Fixed Cost (per category):</strong> Constant costs associated with a service area (compute, storage, network, licensing).</li>
            <li><strong>Variable Cost per Unit:</strong> Costs that increase with usage (e.g., per compute hour or per GB stored).</li>
            <li><strong>Tier 1 &amp; Tier 2 Thresholds:</strong> Usage limits that trigger discounted pricing rates.</li>
            <li><strong>Tier 1 &amp; Tier 2 Discount Rates (%):</strong> Percentage discounts applied when usage exceeds the defined thresholds.</li>
            <li><strong>Monthly Growth Rate (%):</strong> Expected month-over-month increase in usage and costs.</li>
            <li><strong>Simulation Iterations:</strong> Number of runs in a Monte Carlo simulation to model uncertainty.</li>
            <li><strong>Cost &amp; Revenue Variability (%):</strong> Anticipated fluctuations in costs and revenues due to market conditions.</li>
            <li><strong>Live Cloud Pricing:</strong> Real-time pricing data (or fallback static values) from major cloud providers.</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Overall & Revenue Inputs Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#inputsSection" aria-expanded="true" aria-controls="inputsSection">
        Overall &amp; Revenue Inputs
      </div>
      <div id="inputsSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Enter your overall fixed costs and revenue assumptions to form the basis of your financial model.
          </p>
          <div class="form-group">
            <label for="overallFixedCost">Overall Fixed Cost ($):</label>
            <input type="number" id="overallFixedCost" class="form-control" value="1000" step="any">
          </div>
          <h5>Revenue Inputs</h5>
          <p class="instruction">
            Provide your base revenue per unit and total revenue units. An elasticity factor will adjust revenue if usage exceeds the threshold.
          </p>
          <div class="form-group">
            <label for="revenuePerUnit">Base Revenue per Unit ($):</label>
            <input type="number" id="revenuePerUnit" class="form-control" value="25" step="any">
          </div>
          <div class="form-group">
            <label for="revenueUnits">Revenue Units:</label>
            <input type="number" id="revenueUnits" class="form-control" value="1000" step="any">
          </div>
          <div class="form-group">
            <label for="elasticityThresholdRev">Elasticity Threshold (Revenue Units):</label>
            <input type="number" id="elasticityThresholdRev" class="form-control" value="800" step="any">
          </div>
          <div class="form-group">
            <label for="elasticityFactorRev">Elasticity Factor (Revenue $ drop per unit beyond threshold):</label>
            <input type="number" id="elasticityFactorRev" class="form-control" value="0.03" step="any">
          </div>
        </div>
      </div>
    </div>

    <!-- Cost Categories Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#costCategoriesSection" aria-expanded="true" aria-controls="costCategoriesSection">
        Cost Categories
      </div>
      <div id="costCategoriesSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Enter the costs for each service category using a tiered discount model.
          </p>
          <!-- Compute Category -->
          <div class="card mb-3">
            <div class="card-header" data-toggle="collapse" data-target="#computeSection" aria-expanded="true" aria-controls="computeSection">
              Compute
            </div>
            <div id="computeSection" class="collapse show">
              <div class="card-body">
                <p class="instruction">Enter your compute costs (e.g., server hours). Tiered discounting applies based on usage thresholds.</p>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="computeFixed">Fixed Cost ($):</label>
                    <input type="number" id="computeFixed" class="form-control" value="500" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="computeVariable">Variable Cost per Unit ($):</label>
                    <input type="number" id="computeVariable" class="form-control" value="0.15" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="computeUnits">Units (e.g., compute hours):</label>
                    <input type="number" id="computeUnits" class="form-control" value="6000" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="computeTier1Threshold">Tier 1 Threshold:</label>
                    <input type="number" id="computeTier1Threshold" class="form-control" value="4000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="computeTier1Rate">Tier 1 Discount Rate (%):</label>
                    <input type="number" id="computeTier1Rate" class="form-control" value="5" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="computeTier2Threshold">Tier 2 Threshold:</label>
                    <input type="number" id="computeTier2Threshold" class="form-control" value="8000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="computeTier2Rate">Tier 2 Discount Rate (%):</label>
                    <input type="number" id="computeTier2Rate" class="form-control" value="10" step="any">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Storage Category -->
          <div class="card mb-3">
            <div class="card-header" data-toggle="collapse" data-target="#storageSection" aria-expanded="true" aria-controls="storageSection">
              Storage
            </div>
            <div id="storageSection" class="collapse show">
              <div class="card-body">
                <p class="instruction">Enter your storage costs (e.g., GB used). Tiered discounting applies here as well.</p>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="storageFixed">Fixed Cost ($):</label>
                    <input type="number" id="storageFixed" class="form-control" value="300" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="storageVariable">Variable Cost per Unit ($):</label>
                    <input type="number" id="storageVariable" class="form-control" value="0.05" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="storageUnits">Units (e.g., GB):</label>
                    <input type="number" id="storageUnits" class="form-control" value="20000" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="storageTier1Threshold">Tier 1 Threshold:</label>
                    <input type="number" id="storageTier1Threshold" class="form-control" value="15000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="storageTier1Rate">Tier 1 Discount Rate (%):</label>
                    <input type="number" id="storageTier1Rate" class="form-control" value="3" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="storageTier2Threshold">Tier 2 Threshold:</label>
                    <input type="number" id="storageTier2Threshold" class="form-control" value="30000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="storageTier2Rate">Tier 2 Discount Rate (%):</label>
                    <input type="number" id="storageTier2Rate" class="form-control" value="7" step="any">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Network Category -->
          <div class="card mb-3">
            <div class="card-header" data-toggle="collapse" data-target="#networkSection" aria-expanded="true" aria-controls="networkSection">
              Network
            </div>
            <div id="networkSection" class="collapse show">
              <div class="card-body">
                <p class="instruction">Enter your network costs (e.g., data transferred in GB). Discounts apply based on usage thresholds.</p>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="networkFixed">Fixed Cost ($):</label>
                    <input type="number" id="networkFixed" class="form-control" value="200" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="networkVariable">Variable Cost per Unit ($):</label>
                    <input type="number" id="networkVariable" class="form-control" value="0.10" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="networkUnits">Units (e.g., GB transferred):</label>
                    <input type="number" id="networkUnits" class="form-control" value="10000" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="networkTier1Threshold">Tier 1 Threshold:</label>
                    <input type="number" id="networkTier1Threshold" class="form-control" value="8000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="networkTier1Rate">Tier 1 Discount Rate (%):</label>
                    <input type="number" id="networkTier1Rate" class="form-control" value="4" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="networkTier2Threshold">Tier 2 Threshold:</label>
                    <input type="number" id="networkTier2Threshold" class="form-control" value="15000" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="networkTier2Rate">Tier 2 Discount Rate (%):</label>
                    <input type="number" id="networkTier2Rate" class="form-control" value="8" step="any">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- License Category -->
          <div class="card mb-3">
            <div class="card-header" data-toggle="collapse" data-target="#licenseSection" aria-expanded="true" aria-controls="licenseSection">
              License
            </div>
            <div id="licenseSection" class="collapse show">
              <div class="card-body">
                <p class="instruction">Enter your licensing costs (e.g., software seats). Volume discounts may apply.</p>
                <div class="form-row">
                  <div class="form-group col-md-4">
                    <label for="licenseFixed">Fixed Cost ($):</label>
                    <input type="number" id="licenseFixed" class="form-control" value="400" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="licenseVariable">Variable Cost per Unit ($):</label>
                    <input type="number" id="licenseVariable" class="form-control" value="1.00" step="any">
                  </div>
                  <div class="form-group col-md-4">
                    <label for="licenseUnits">Units (e.g., seats):</label>
                    <input type="number" id="licenseUnits" class="form-control" value="300" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="licenseTier1Threshold">Tier 1 Threshold:</label>
                    <input type="number" id="licenseTier1Threshold" class="form-control" value="250" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="licenseTier1Rate">Tier 1 Discount Rate (%):</label>
                    <input type="number" id="licenseTier1Rate" class="form-control" value="10" step="any">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="licenseTier2Threshold">Tier 2 Threshold:</label>
                    <input type="number" id="licenseTier2Threshold" class="form-control" value="500" step="any">
                  </div>
                  <div class="form-group col-md-6">
                    <label for="licenseTier2Rate">Tier 2 Discount Rate (%):</label>
                    <input type="number" id="licenseTier2Rate" class="form-control" value="15" step="any">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Advanced Settings Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#advancedSection" aria-expanded="true" aria-controls="advancedSection">
        Advanced Settings
      </div>
      <div id="advancedSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Use these advanced settings to further optimize your cost model.
          </p>
          <div class="form-group">
            <label for="autoScalingFactor">Auto-Scaling Factor (%) [reduces compute cost]:</label>
            <input type="number" id="autoScalingFactor" class="form-control" value="0" step="any">
          </div>
          <div class="form-group">
            <label for="dynamicPricingAdjustment">Dynamic Pricing Adjustment (%) [boosts revenue per unit]:</label>
            <input type="number" id="dynamicPricingAdjustment" class="form-control" value="0" step="any">
          </div>
        </div>
      </div>
    </div>

    <!-- Cloud Pricing Integration Section with Ticker -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#cloudPricingSection" aria-expanded="true" aria-controls="cloudPricingSection">
        Cloud Pricing Integration (Live)
      </div>
      <div id="cloudPricingSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Click the button below to fetch the latest pricing data. Due to timeout issues with official endpoints, fallback static pricing values are used.
          </p>
          <button id="fetchCloudPrices" class="btn btn-primary mb-3">Fetch Latest Cloud Prices</button>
          <div id="cloudPricingResults" class="result" style="display:none;"></div>
          <!-- Ticker for Cloud Pricing -->
          <div class="ticker-container">
            <div id="pricingTicker" class="ticker">
              Loading pricing ticker...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Forecasting Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#forecastSection" aria-expanded="true" aria-controls="forecastSection">
        Forecasting (12‑Month Projection)
      </div>
      <div id="forecastSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Enter your expected monthly growth rate to project revenue, costs, and profit over the next 12 months.
          </p>
          <div class="form-group">
            <label for="monthlyGrowth">Monthly Growth Rate (%):</label>
            <input type="number" id="monthlyGrowth" class="form-control" value="5" step="any">
          </div>
          <button id="runForecast" class="btn btn-success mb-3">Run Forecast</button>
          <canvas id="forecastChart" width="600" height="300" style="display:none;"></canvas>
        </div>
      </div>
    </div>

    <!-- Deterministic Calculation Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#deterministicSection" aria-expanded="true" aria-controls="deterministicSection">
        Deterministic Calculation &amp; Results
      </div>
      <div id="deterministicSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Click the button below to calculate key financial metrics and see a detailed cost breakdown.
          </p>
          <button id="calculateBtn" class="btn btn-warning mb-3">Calculate Deterministic Metrics</button>
          <div id="deterministicResults" class="result" style="display:none;"></div>
          <canvas id="pieChart" width="400" height="200" style="display:none;"></canvas>
        </div>
      </div>
    </div>

    <!-- Monte Carlo Simulation Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#simulationSection" aria-expanded="true" aria-controls="simulationSection">
        Monte Carlo Simulation
      </div>
      <div id="simulationSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Use this section to simulate uncertainty in your cost and revenue estimates. Adjust the variability percentages and number of iterations to model risk.
          </p>
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="simIterations">Simulation Iterations:</label>
              <input type="number" id="simIterations" class="form-control" value="1000" step="1">
            </div>
            <div class="form-group col-md-4">
              <label for="costVariability">Cost Variability (%):</label>
              <input type="number" id="costVariability" class="form-control" value="10" step="any">
            </div>
            <div class="form-group col-md-4">
              <label for="revenueVariability">Revenue Variability (%):</label>
              <input type="number" id="revenueVariability" class="form-control" value="10" step="any">
            </div>
          </div>
          <button id="runSimulation" class="btn btn-danger mb-3">Run Simulation</button>
          <div id="simulationResults" class="result" style="display:none;"></div>
          <canvas id="histogramChart" width="600" height="300" style="display:none;"></canvas>
        </div>
      </div>
    </div>

    <!-- Sensitivity Analysis Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#sensitivitySection" aria-expanded="true" aria-controls="sensitivitySection">
        Sensitivity Analysis
      </div>
      <div id="sensitivitySection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Examine how varying key parameters (such as the Compute Tier 1 discount rate) affects overall profitability.
          </p>
          <button id="runSensitivity" class="btn btn-info mb-3">Run Sensitivity Analysis</button>
          <div id="sensitivityResults" class="result" style="display:none;"></div>
        </div>
      </div>
    </div>

    <!-- Export Report Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#exportSection" aria-expanded="true" aria-controls="exportSection">
        Export Report
      </div>
      <div id="exportSection" class="collapse show">
        <div class="card-body">
          <p class="instruction">
            Generate a professional PDF report summarizing your analysis—including key metrics and charts—for sharing with your team.
          </p>
          <button id="exportReportBtn" class="btn btn-secondary">Export Report as PDF</button>
        </div>
      </div>
    </div>

    <!-- Official Pricing Resources Section -->
    <div class="card section-card">
      <div class="card-header" data-toggle="collapse" data-target="#pricingResourcesSection" aria-expanded="true" aria-controls="pricingResourcesSection">
        Official Pricing Resources
      </div>
      <div id="pricingResourcesSection" class="collapse show">
        <div class="card-body">
          <p>
            For the most accurate and up-to-date pricing information, refer directly to the official pricing pages of the major cloud providers:
          </p>
          <ul>
            <li><a href="https://aws.amazon.com/pricing/" target="_blank">AWS Pricing</a></li>
            <li><a href="https://azure.microsoft.com/en-us/pricing/" target="_blank">Azure Pricing</a></li>
            <li><a href="https://cloud.google.com/pricing" target="_blank">Google Cloud Pricing</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>For further inquiries, please reach out to <a href="mailto:info@tullyedmvibe.com">info@tullyedmvibe.com</a></p>
    </footer>
  </div>

  <!-- Dependencies: jQuery, Bootstrap JS (for collapse), Chart.js, jsPDF -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // ---------- Persistence: Save inputs to localStorage ----------
    function persistInputs() {
      const inputs = document.querySelectorAll('input[type="number"]');
      inputs.forEach(input => {
        const stored = localStorage.getItem(input.id);
        if (stored !== null) { input.value = stored; }
        input.addEventListener('change', () => { localStorage.setItem(input.id, input.value); });
      });
    }
    window.addEventListener('DOMContentLoaded', persistInputs);

    // ---------- Cloud Pricing Fetch Functions (Fallback Static Values) ----------
    async function fetchAWSComputePrice() {
      return "0.13"; // Fallback static price for compute (t2.micro)
    }
    async function fetchAWSStoragePrice() {
      return "0.05"; // Fallback static price for S3 Standard (per GB)
    }
    async function fetchAWSNetworkPrice() {
      return "0.09"; // Fallback static price for Data Transfer Out (per GB)
    }
    document.getElementById('fetchCloudPrices').addEventListener('click', async () => {
      const resultsDiv = document.getElementById('cloudPricingResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = '<p>Fetching fallback cloud pricing…</p>';
      try {
        const [awsCompute, awsStorage, awsNetwork] = await Promise.all([
          fetchAWSComputePrice(),
          fetchAWSStoragePrice(),
          fetchAWSNetworkPrice()
        ]);
        let html = '<h5>Fallback AWS Prices:</h5><table class="table table-bordered"><thead><tr><th>Category</th><th>Price ($/unit)</th></tr></thead><tbody>';
        html += `<tr><td>Compute (t2.micro)</td><td>${awsCompute}</td></tr>`;
        html += `<tr><td>Storage (S3 Standard)</td><td>${awsStorage}</td></tr>`;
        html += `<tr><td>Network (Data Transfer Out)</td><td>${awsNetwork}</td></tr>`;
        html += '</tbody></table>';
        resultsDiv.innerHTML = html;
        
        // Update ticker text with fallback pricing data
        const tickerText = `AWS Compute: $${awsCompute} | AWS Storage: $${awsStorage} per GB | AWS Network: $${awsNetwork} per GB`;
        document.getElementById('pricingTicker').innerText = tickerText;
      } catch (error) {
        resultsDiv.innerHTML = '<p>Error fetching cloud pricing data.</p>';
        document.getElementById('pricingTicker').innerText = "Error fetching pricing.";
      }
    });

    // ---------- Helper: Compute Category Cost with Tiered Discounts ----------
    function computeCategoryCost(units, baseCost, tier1Threshold, tier1Rate, tier2Threshold, tier2Rate) {
      let cost = 0;
      if (units <= tier1Threshold) {
        cost = units * baseCost;
      } else if (units <= tier2Threshold) {
        cost = tier1Threshold * baseCost + (units - tier1Threshold) * baseCost * (1 - tier1Rate / 100);
      } else {
        cost = tier1Threshold * baseCost +
               (tier2Threshold - tier1Threshold) * baseCost * (1 - tier1Rate / 100) +
               (units - tier2Threshold) * baseCost * (1 - tier2Rate / 100);
      }
      return cost;
    }

    // ---------- Deterministic Calculation (with Advanced Settings) ----------
    document.getElementById('calculateBtn').addEventListener('click', () => {
      // Base inputs
      const overallFixedCost = parseFloat(document.getElementById('overallFixedCost').value);
      const revenuePerUnit = parseFloat(document.getElementById('revenuePerUnit').value);
      const revenueUnits = parseFloat(document.getElementById('revenueUnits').value);
      const elasticityThresholdRev = parseFloat(document.getElementById('elasticityThresholdRev').value);
      const elasticityFactorRev = parseFloat(document.getElementById('elasticityFactorRev').value);
      
      // Advanced inputs
      const dynamicPricingAdjustment = parseFloat(document.getElementById('dynamicPricingAdjustment').value);
      const autoScalingFactor = parseFloat(document.getElementById('autoScalingFactor').value);
      
      // Adjust effective revenue per unit with elasticity and dynamic pricing
      let effectiveRevenuePerUnit = revenuePerUnit;
      if (revenueUnits > elasticityThresholdRev) {
        effectiveRevenuePerUnit = Math.max(revenuePerUnit - elasticityFactorRev * (revenueUnits - elasticityThresholdRev), 0);
      }
      effectiveRevenuePerUnit = effectiveRevenuePerUnit * (1 + dynamicPricingAdjustment / 100);
      const totalRevenue = revenueUnits * effectiveRevenuePerUnit;

      // Compute costs
      const computeFixed = parseFloat(document.getElementById('computeFixed').value);
      const computeVariable = parseFloat(document.getElementById('computeVariable').value);
      const computeUnits = parseFloat(document.getElementById('computeUnits').value);
      const computeTier1Threshold = parseFloat(document.getElementById('computeTier1Threshold').value);
      const computeTier1Rate = parseFloat(document.getElementById('computeTier1Rate').value);
      const computeTier2Threshold = parseFloat(document.getElementById('computeTier2Threshold').value);
      const computeTier2Rate = parseFloat(document.getElementById('computeTier2Rate').value);
      let computeCost = computeFixed + computeCategoryCost(computeUnits, computeVariable, computeTier1Threshold, computeTier1Rate, computeTier2Threshold, computeTier2Rate);
      // Apply auto-scaling adjustment
      computeCost = computeCost * (1 - autoScalingFactor / 100);

      // Storage costs
      const storageFixed = parseFloat(document.getElementById('storageFixed').value);
      const storageVariable = parseFloat(document.getElementById('storageVariable').value);
      const storageUnits = parseFloat(document.getElementById('storageUnits').value);
      const storageTier1Threshold = parseFloat(document.getElementById('storageTier1Threshold').value);
      const storageTier1Rate = parseFloat(document.getElementById('storageTier1Rate').value);
      const storageTier2Threshold = parseFloat(document.getElementById('storageTier2Threshold').value);
      const storageTier2Rate = parseFloat(document.getElementById('storageTier2Rate').value);
      const storageCost = storageFixed + computeCategoryCost(storageUnits, storageVariable, storageTier1Threshold, storageTier1Rate, storageTier2Threshold, storageTier2Rate);

      // Network costs
      const networkFixed = parseFloat(document.getElementById('networkFixed').value);
      const networkVariable = parseFloat(document.getElementById('networkVariable').value);
      const networkUnits = parseFloat(document.getElementById('networkUnits').value);
      const networkTier1Threshold = parseFloat(document.getElementById('networkTier1Threshold').value);
      const networkTier1Rate = parseFloat(document.getElementById('networkTier1Rate').value);
      const networkTier2Threshold = parseFloat(document.getElementById('networkTier2Threshold').value);
      const networkTier2Rate = parseFloat(document.getElementById('networkTier2Rate').value);
      const networkCost = networkFixed + computeCategoryCost(networkUnits, networkVariable, networkTier1Threshold, networkTier1Rate, networkTier2Threshold, networkTier2Rate);

      // License costs
      const licenseFixed = parseFloat(document.getElementById('licenseFixed').value);
      const licenseVariable = parseFloat(document.getElementById('licenseVariable').value);
      const licenseUnits = parseFloat(document.getElementById('licenseUnits').value);
      const licenseTier1Threshold = parseFloat(document.getElementById('licenseTier1Threshold').value);
      const licenseTier1Rate = parseFloat(document.getElementById('licenseTier1Rate').value);
      const licenseTier2Threshold = parseFloat(document.getElementById('licenseTier2Threshold').value);
      const licenseTier2Rate = parseFloat(document.getElementById('licenseTier2Rate').value);
      const licenseCost = licenseFixed + computeCategoryCost(licenseUnits, licenseVariable, licenseTier1Threshold, licenseTier1Rate, licenseTier2Threshold, licenseTier2Rate);

      const totalCost = overallFixedCost + computeCost + storageCost + networkCost + licenseCost;
      const profit = totalRevenue - totalCost;
      const profitMargin = totalRevenue ? (profit / totalRevenue * 100).toFixed(2) : "N/A";
      const roi = totalCost ? (profit / totalCost * 100).toFixed(2) : "N/A";

      const resultsDiv = document.getElementById('deterministicResults');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = `
        <h5>Deterministic Results</h5>
        <p><strong>Total Revenue:</strong> $${totalRevenue.toFixed(2)}</p>
        <p><strong>Total Cost:</strong> $${totalCost.toFixed(2)}</p>
        <p><strong>Profit:</strong> $${profit.toFixed(2)}</p>
        <p><strong>Profit Margin:</strong> ${profitMargin}%</p>
        <p><strong>ROI:</strong> ${roi}%</p>
        <h6>Cost Breakdown:</h6>
        <p>Compute: $${computeCost.toFixed(2)}, Storage: $${storageCost.toFixed(2)}, Network: $${networkCost.toFixed(2)}, License: $${licenseCost.toFixed(2)}</p>
      `;

      const pieCtx = document.getElementById('pieChart').getContext('2d');
      document.getElementById('pieChart').style.display = 'block';
      if (window.myPieChart) window.myPieChart.destroy();
      window.myPieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: ['Compute', 'Storage', 'Network', 'License'],
          datasets: [{
            data: [computeCost, storageCost, networkCost, licenseCost],
            backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(255, 206, 86, 0.6)', 'rgba(75, 192, 192, 0.6)']
          }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
    });

    // ---------- Forecasting (12‑Month Projection) ----------
    document.getElementById('runForecast').addEventListener('click', () => {
      const months = 12;
      const monthlyGrowth = parseFloat(document.getElementById('monthlyGrowth').value) / 100;
      const overallFixedCost = parseFloat(document.getElementById('overallFixedCost').value);
      const revenuePerUnit = parseFloat(document.getElementById('revenuePerUnit').value);
      const revenueUnits = parseFloat(document.getElementById('revenueUnits').value);
      const elasticityThresholdRev = parseFloat(document.getElementById('elasticityThresholdRev').value);
      const elasticityFactorRev = parseFloat(document.getElementById('elasticityFactorRev').value);
      
      // Advanced dynamic pricing adjustment
      const dynamicPricingAdjustment = parseFloat(document.getElementById('dynamicPricingAdjustment').value);
      
      function getBaselineCost(idPrefix) {
        const fixed = parseFloat(document.getElementById(idPrefix + 'Fixed').value);
        const variable = parseFloat(document.getElementById(idPrefix + 'Variable').value);
        const units = parseFloat(document.getElementById(idPrefix + 'Units').value);
        const tier1Threshold = parseFloat(document.getElementById(idPrefix + 'Tier1Threshold').value);
        const tier1Rate = parseFloat(document.getElementById(idPrefix + 'Tier1Rate').value);
        const tier2Threshold = parseFloat(document.getElementById(idPrefix + 'Tier2Threshold').value);
        const tier2Rate = parseFloat(document.getElementById(idPrefix + 'Tier2Rate').value);
        return fixed + computeCategoryCost(units, variable, tier1Threshold, tier1Rate, tier2Threshold, tier2Rate);
      }
      const computeCostBase = getBaselineCost('compute');
      const storageCostBase = getBaselineCost('storage');
      const networkCostBase = getBaselineCost('network');
      const licenseCostBase = getBaselineCost('license');
      const overallCostBase = overallFixedCost + computeCostBase + storageCostBase + networkCostBase + licenseCostBase;

      let forecastMonths = [];
      let forecastRevenue = [];
      let forecastCost = [];
      let forecastProfit = [];

      let currentRevenueUnits = revenueUnits;
      let currentOverallCost = overallCostBase;
      for (let m = 0; m <= months; m++) {
        let effectiveRevenuePerUnit = revenuePerUnit;
        if (currentRevenueUnits > elasticityThresholdRev) {
          effectiveRevenuePerUnit = Math.max(revenuePerUnit - elasticityFactorRev * (currentRevenueUnits - elasticityThresholdRev), 0);
        }
        effectiveRevenuePerUnit = effectiveRevenuePerUnit * (1 + dynamicPricingAdjustment / 100);
        const totalRev = currentRevenueUnits * effectiveRevenuePerUnit;
        forecastMonths.push("Month " + m);
        forecastRevenue.push(totalRev);
        forecastCost.push(currentOverallCost);
        forecastProfit.push(totalRev - currentOverallCost);

        currentRevenueUnits *= (1 + monthlyGrowth);
        currentOverallCost *= (1 + monthlyGrowth);
      }

      const forecastCtx = document.getElementById('forecastChart').getContext('2d');
      document.getElementById('forecastChart').style.display = 'block';
      if (window.myForecastChart) window.myForecastChart.destroy();
      window.myForecastChart = new Chart(forecastCtx, {
        type: 'line',
        data: {
          labels: forecastMonths,
          datasets: [
            { label: 'Revenue', data: forecastRevenue, borderColor: 'rgba(75, 192, 192, 1)', fill: false },
            { label: 'Cost', data: forecastCost, borderColor: 'rgba(255, 99, 132, 1)', fill: false },
            { label: 'Profit', data: forecastProfit, borderColor: 'rgba(54, 162, 235, 1)', fill: false }
          ]
        },
        options: {
          plugins: { legend: { position: 'bottom' } },
          scales: { y: { beginAtZero: true } }
        }
      });
    });

    // ---------- Monte Carlo Simulation ----------
    document.getElementById('runSimulation').addEventListener('click', () => {
      const simIterations = parseInt(document.getElementById('simIterations').value);
      const costVariability = parseFloat(document.getElementById('costVariability').value) / 100;
      const revenueVariability = parseFloat(document.getElementById('revenueVariability').value) / 100;
      const revenuePerUnit = parseFloat(document.getElementById('revenuePerUnit').value);
      const revenueUnits = parseFloat(document.getElementById('revenueUnits').value);
      const elasticityThresholdRev = parseFloat(document.getElementById('elasticityThresholdRev').value);
      const elasticityFactorRev = parseFloat(document.getElementById('elasticityFactorRev').value);
      const overallFixedCost = parseFloat(document.getElementById('overallFixedCost').value);

      // Advanced dynamic pricing adjustment
      const dynamicPricingAdjustment = parseFloat(document.getElementById('dynamicPricingAdjustment').value);

      function getCategoryInputs(idPrefix) {
        return {
          fixed: parseFloat(document.getElementById(idPrefix + 'Fixed').value),
          variable: parseFloat(document.getElementById(idPrefix + 'Variable').value),
          units: parseFloat(document.getElementById(idPrefix + 'Units').value),
          tier1Threshold: parseFloat(document.getElementById(idPrefix + 'Tier1Threshold').value),
          tier1Rate: parseFloat(document.getElementById(idPrefix + 'Tier1Rate').value),
          tier2Threshold: parseFloat(document.getElementById(idPrefix + 'Tier2Threshold').value),
          tier2Rate: parseFloat(document.getElementById(idPrefix + 'Tier2Rate').value)
        };
      }
      const computeInputs = getCategoryInputs('compute');
      const storageInputs = getCategoryInputs('storage');
      const networkInputs = getCategoryInputs('network');
      const licenseInputs = getCategoryInputs('license');

      function getRandomNormal() {
        let u = 0, v = 0;
        while(u === 0) u = Math.random();
        while(v === 0) v = Math.random();
        return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
      }

      const simulationProfits = [];
      for (let i = 0; i < simIterations; i++) {
        const costMultiplier = 1 + getRandomNormal() * costVariability;
        const revenueMultiplier = 1 + getRandomNormal() * revenueVariability;

        const simComputeCost = computeInputs.fixed + computeCategoryCost(computeInputs.units, computeInputs.variable * costMultiplier, computeInputs.tier1Threshold, computeInputs.tier1Rate, computeInputs.tier2Threshold, computeInputs.tier2Rate);
        const simStorageCost = storageInputs.fixed + computeCategoryCost(storageInputs.units, storageInputs.variable * costMultiplier, storageInputs.tier1Threshold, storageInputs.tier1Rate, storageInputs.tier2Threshold, storageInputs.tier2Rate);
        const simNetworkCost = networkInputs.fixed + computeCategoryCost(networkInputs.units, networkInputs.variable * costMultiplier, networkInputs.tier1Threshold, networkInputs.tier1Rate, networkInputs.tier2Threshold, networkInputs.tier2Rate);
        const simLicenseCost = licenseInputs.fixed + computeCategoryCost(licenseInputs.units, licenseInputs.variable * costMultiplier, licenseInputs.tier1Threshold, licenseInputs.tier1Rate, licenseInputs.tier2Threshold, licenseInputs.tier2Rate);
        const totalSimCost = overallFixedCost + simComputeCost + simStorageCost + simNetworkCost + simLicenseCost;

        let simEffectiveRevenue = revenuePerUnit * revenueMultiplier;
        if (revenueUnits > elasticityThresholdRev) {
          simEffectiveRevenue = Math.max(revenuePerUnit * revenueMultiplier - elasticityFactorRev * (revenueUnits - elasticityThresholdRev), 0);
        }
        // Apply dynamic pricing adjustment
        simEffectiveRevenue = simEffectiveRevenue * (1 + dynamicPricingAdjustment / 100);
        const totalSimRevenue = revenueUnits * simEffectiveRevenue;
        simulationProfits.push(totalSimRevenue - totalSimCost);
      }

      const sumProfit = simulationProfits.reduce((a, b) => a + b, 0);
      const avgProfit = sumProfit / simulationProfits.length;
      const minProfit = Math.min(...simulationProfits);
      const maxProfit = Math.max(...simulationProfits);
      const stdProfit = Math.sqrt(simulationProfits.reduce((a, b) => a + Math.pow(b - avgProfit, 2), 0) / simulationProfits.length);

      const numBins = 10;
      const profitRange = maxProfit - minProfit;
      const binSize = profitRange / numBins;
      const bins = new Array(numBins).fill(0);
      const binLabels = [];
      simulationProfits.forEach(profit => {
        let binIndex = Math.floor((profit - minProfit) / binSize);
        if (binIndex === numBins) binIndex = numBins - 1;
        bins[binIndex]++;
      });
      for (let i = 0; i < numBins; i++) {
        const binCenter = minProfit + binSize * (i + 0.5);
        binLabels.push(binCenter.toFixed(2));
      }

      const simResultsDiv = document.getElementById('simulationResults');
      simResultsDiv.style.display = 'block';
      simResultsDiv.innerHTML = `
        <h5>Simulation Summary (over ${simIterations} iterations):</h5>
        <p>Average Profit: $${avgProfit.toFixed(2)}</p>
        <p>Minimum Profit: $${minProfit.toFixed(2)}</p>
        <p>Maximum Profit: $${maxProfit.toFixed(2)}</p>
        <p>Standard Deviation: $${stdProfit.toFixed(2)}</p>
      `;

      const histCtx = document.getElementById('histogramChart').getContext('2d');
      document.getElementById('histogramChart').style.display = 'block';
      if (window.myHistChart) window.myHistChart.destroy();
      window.myHistChart = new Chart(histCtx, {
        type: 'bar',
        data: {
          labels: binLabels,
          datasets: [{
            label: 'Profit Frequency',
            data: bins,
            backgroundColor: 'rgba(153, 102, 255, 0.6)'
          }]
        },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
      });
    });

    // ---------- Sensitivity Analysis ----------
    document.getElementById('runSensitivity').addEventListener('click', () => {
      const baseRate = parseFloat(document.getElementById('computeTier1Rate').value);
      const sensitivityData = [];
      const sensitivityLabels = [];
      for (let delta = -5; delta <= 5; delta += 1) {
        const testRate = baseRate + delta;
        const computeFixed = parseFloat(document.getElementById('computeFixed').value);
        const computeVariable = parseFloat(document.getElementById('computeVariable').value);
        const computeUnits = parseFloat(document.getElementById('computeUnits').value);
        const computeTier1Threshold = parseFloat(document.getElementById('computeTier1Threshold').value);
        const computeTier2Threshold = parseFloat(document.getElementById('computeTier2Threshold').value);
        const computeTier2Rate = parseFloat(document.getElementById('computeTier2Rate').value);
        const modifiedComputeCost = computeFixed + computeCategoryCost(computeUnits, computeVariable, computeTier1Threshold, testRate, computeTier2Threshold, computeTier2Rate);

        const overallFixedCost = parseFloat(document.getElementById('overallFixedCost').value);
        const storageCost = parseFloat(document.getElementById('storageFixed').value) + computeCategoryCost(
          parseFloat(document.getElementById('storageUnits').value),
          parseFloat(document.getElementById('storageVariable').value),
          parseFloat(document.getElementById('storageTier1Threshold').value),
          parseFloat(document.getElementById('storageTier1Rate').value),
          parseFloat(document.getElementById('storageTier2Threshold').value),
          parseFloat(document.getElementById('storageTier2Rate').value)
        );
        const networkCost = parseFloat(document.getElementById('networkFixed').value) + computeCategoryCost(
          parseFloat(document.getElementById('networkUnits').value),
          parseFloat(document.getElementById('networkVariable').value),
          parseFloat(document.getElementById('networkTier1Threshold').value),
          parseFloat(document.getElementById('networkTier1Rate').value),
          parseFloat(document.getElementById('networkTier2Threshold').value),
          parseFloat(document.getElementById('networkTier2Rate').value)
        );
        const licenseCost = parseFloat(document.getElementById('licenseFixed').value) + computeCategoryCost(
          parseFloat(document.getElementById('licenseUnits').value),
          parseFloat(document.getElementById('licenseVariable').value),
          parseFloat(document.getElementById('licenseTier1Threshold').value),
          parseFloat(document.getElementById('licenseTier1Rate').value),
          parseFloat(document.getElementById('licenseTier2Threshold').value),
          parseFloat(document.getElementById('licenseTier2Rate').value)
        );

        const revenuePerUnit = parseFloat(document.getElementById('revenuePerUnit').value);
        const revenueUnits = parseFloat(document.getElementById('revenueUnits').value);
        const elasticityThresholdRev = parseFloat(document.getElementById('elasticityThresholdRev').value);
        const elasticityFactorRev = parseFloat(document.getElementById('elasticityFactorRev').value);
        let effectiveRevenuePerUnit = revenuePerUnit;
        if (revenueUnits > elasticityThresholdRev) {
          effectiveRevenuePerUnit = Math.max(revenuePerUnit - elasticityFactorRev * (revenueUnits - elasticityThresholdRev), 0);
        }
        const totalRevenue = revenueUnits * effectiveRevenuePerUnit;
        const totalCost = overallFixedCost + modifiedComputeCost + storageCost + networkCost + licenseCost;
        const profit = totalRevenue - totalCost;
        sensitivityData.push(profit);
        sensitivityLabels.push(testRate.toFixed(2) + "%");
      }

      const sensitivityResultsDiv = document.getElementById('sensitivityResults');
      sensitivityResultsDiv.style.display = 'block';
      let tableHTML = '<h5>Sensitivity Analysis: Profit vs. Compute Tier 1 Discount Rate</h5><table class="table table-sm table-bordered"><thead><tr><th>Tier 1 Discount Rate</th><th>Profit ($)</th></tr></thead><tbody>';
      for (let i = 0; i < sensitivityLabels.length; i++) {
        tableHTML += `<tr><td>${sensitivityLabels[i]}</td><td>${sensitivityData[i].toFixed(2)}</td></tr>`;
      }
      tableHTML += '</tbody></table>';
      sensitivityResultsDiv.innerHTML = tableHTML;
    });

    // ---------- Export Report as PDF ----------
    async function exportReport() {
      const deterministicHTML = document.getElementById('deterministicResults').innerText;
      const simulationHTML = document.getElementById('simulationResults').innerText;
      const sensitivityHTML = document.getElementById('sensitivityResults').innerText;
      const forecastCanvas = document.getElementById('forecastChart');

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("FinOps Analysis Report", 10, 15);
      doc.setFontSize(12);
      doc.text("Deterministic Metrics:", 10, 25);
      doc.text(deterministicHTML, 10, 35);

      let yPos = 60;
      doc.text("Monte Carlo Simulation Summary:", 10, yPos);
      yPos += 10;
      doc.text(simulationHTML, 10, yPos);

      yPos += 20;
      doc.text("Sensitivity Analysis:", 10, yPos);
      yPos += 10;
      doc.text(sensitivityHTML, 10, yPos);

      if (forecastCanvas && forecastCanvas.style.display !== 'none') {
        const imgData = forecastCanvas.toDataURL("image/png");
        yPos += 30;
        doc.text("12‑Month Forecast Chart:", 10, yPos);
        yPos += 10;
        doc.addImage(imgData, 'PNG', 10, yPos, 180, 80);
      }

      doc.save("FinOps_Report.pdf");
    }
    document.getElementById('exportReportBtn').addEventListener('click', exportReport);
  </script>
</body>
</html>
